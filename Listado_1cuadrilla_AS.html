<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Asistencia de Cuadrilla</title>
    <style>
        /* CSS Básico */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #4a4a4a;
            font-size: 2em;
            margin-top: 10px;
        }
        .logo {
            max-width: 120px;
            height: auto;
            margin-bottom: 15px;
            border-radius: 50%;
            border: 3px solid #7c0000; /* Color simbólico de Hermandad */
        }
        /* Estilos de Búsqueda */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        #searchInput {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }
        #searchButton {
            padding: 10px 15px;
            background-color: #7c0000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        #searchButton:hover {
            background-color: #5d0000;
        }

        /* Estilos de la Tabla */
        .data-table-container {
            overflow-x: auto;
        }
        #attendanceTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        #attendanceTable th, #attendanceTable td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        #attendanceTable th {
            background-color: #7c0000;
            color: white;
            text-transform: uppercase;
            font-size: 0.85em;
            cursor: pointer; /* Para futura funcionalidad de ordenar */
        }
        #attendanceTable tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        #attendanceTable tr:hover {
            background-color: #e9e9e9;
        }
        /* Estilos específicos para la columna de nombre */
        #attendanceTable .hermano-name {
            text-align: left;
            font-weight: 500;
        }
        /* Estilo para las asistencias (1 o 0) */
        .asistencia-si { color: green; font-weight: bold; }
        .asistencia-no { color: red; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img id="cuadrillaLogo" class="logo" src="" alt="Logo de Cuadrilla">
        <h1 id="cuadrillaTitle">Cargando Título...</h1>
        <p id="infoId">ID de Cuadrilla: Cargando...</p>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Buscar hermano por nombre o apellido...">
        <button id="searchButton" onclick="filterTable()">Buscar</button>
    </div>

    <div class="data-table-container">
        <table id="attendanceTable">
            <thead>
                <tr id="tableHeaderRow">
                    </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
        <p id="noResults" style="display:none; text-align: center; margin-top: 20px; color: #7c0000;">No se encontraron resultados para la búsqueda.</p>
    </div>
</div>

<script>
    // Función para obtener el parámetro 'id' de la URL
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Función para determinar el título de la cuadrilla
    function getCuadrillaTitle(id) {
        const titles = {
            '1': 'Primera Cuadrilla', '2': 'Segunda Cuadrilla', '3': 'Tercera Cuadrilla', '4': 'Cuarta Cuadrilla', 
            '5': 'Quinta Cuadrilla', '6': 'Sexta Cuadrilla', '7': 'Séptima Cuadrilla', '8': 'Octava Cuadrilla', 
            '9': 'Novena Cuadrilla', '10': 'Décima Cuadrilla', '11': 'Undécima Cuadrilla', '12': 'Duodécima Cuadrilla', 
            '13': 'Decimotercera Cuadrilla', '14': 'Decimocuarta Cuadrilla', '15': 'Decimoquinta Cuadrilla', 
            '16': 'Decimosexta Cuadrilla', '17': 'Decimoséptima Cuadrilla', '18': 'Decimoctava Cuadrilla', 
            '19': 'Decimonovena Cuadrilla', '20': 'Vigésima Cuadrilla',
            'gs': 'Grupo de Sahumadoras',
            'gc': 'Grupo de Cantoras'
        };
        return titles[id] || `Cuadrilla ID ${id} (Desconocida)`;
    }

    // Función para determinar el nombre del archivo de logo
    function getLogoFileName(id) {
        if (id >= 1 && id <= 20) {
            return `${id}__.png`; // Asumiendo que el formato es N_.png, usé N__.png como ejemplo. Si el formato es N_.png, cambia a `${id}_.png`
        } else if (id === 'gs') {
            return 'gs_.png';
        } else if (id === 'gc') {
            return 'gc_.png';
        }
        return 'default.png'; // Un logo por defecto si el ID es inválido
    }

    // Datos JSON de la Cuadrilla 12 (SIMULACIÓN DE CARGA)
    // En un entorno real, la función loadAttendanceData haría una petición `fetch('12.json')`
    const dataCuadrilla12 = [
        // Aquí va el JSON completo que proporcionaste
        { "nro": 1, "apellidos_y_nombres": "ACOSTA NAFRIA, GUSTAVO JESUS", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 2, "apellidos_y_nombres": "AGUILAR VILLA, MIGUEL ERNESTO", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 1, "OCT": 1, "NOV": 1, "TOT": 4 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 1, "JN5": 1, "JN6": 1, "TOT": 6 } }, "total_general_puntos": 11 },
        { "nro": 3, "apellidos_y_nombres": "ALVARADO AVALOS, FRANCIS EMANUEL", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 1, "TOT": 1 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 3 },
        { "nro": 4, "apellidos_y_nombres": "ANDRADE CACERES, RAUL ALBERTO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 1, "JN5": 1, "JN6": 1, "TOT": 6 } }, "total_general_puntos": 8 },
        { "nro": 5, "apellidos_y_nombres": "ANDRADE CACERES, RAUL ELIAS", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 1, "OCT": 1, "NOV": 1, "TOT": 3 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 1, "JN5": 0, "JN6": 1, "TOT": 2 } }, "total_general_puntos": 6 },
        { "nro": 6, "apellidos_y_nombres": "BAILÓN ROJAS, LUIS ALFONSO", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 1, "OCT": 1, "NOV": 1, "TOT": 4 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 4 },
        { "nro": 7, "apellidos_y_nombres": "BALDEÓN ROJAS, OSWALDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 8, "apellidos_y_nombres": "BARBOZA DIAZ, JAVIER WILFREDO", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 3 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 1 } }, "total_general_puntos": 4 },
        { "nro": 9, "apellidos_y_nombres": "BERNILLA MASUDA, JUAN CARLOS", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 3 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 1, "JN5": 0, "JN6": 1, "TOT": 3 } }, "total_general_puntos": 6 },
        { "nro": 10, "apellidos_y_nombres": "BERTO VALENCIA, ALEX ROLANDO", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 3 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 1, "JN5": 0, "JN6": 1, "TOT": 3 } }, "total_general_puntos": 7 },
        { "nro": 11, "apellidos_y_nombres": "BOHORQUEZ PEREZ, MANUEL", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 12, "apellidos_y_nombres": "BONILLA MASUDA, LIZANDRO ALBERTO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 13, "apellidos_y_nombres": "BONILLA ROJAS, SANTOS MARTIN", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 1, "JN5": 1, "JN6": 0, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 14, "apellidos_y_nombres": "CABRERA ECHEVARRIA, FELIX DAMIANO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 1 } }, "total_general_puntos": 3 },
        { "nro": 15, "apellidos_y_nombres": "CANDELA ROLDAN, RUBEN", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 1, "JN5": 1, "JN6": 1, "TOT": 6 } }, "total_general_puntos": 8 },
        { "nro": 16, "apellidos_y_nombres": "CANO RIVERA, LUIS ALBERTO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 17, "apellidos_y_nombres": "CAVERO CASARRANCAN, MIGUEL GERMAN", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 18, "apellidos_y_nombres": "CENTENO URDINITA, ERNESTO ROMAN", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 1 } }, "total_general_puntos": 3 },
        { "nro": 19, "apellidos_y_nombres": "COLLAZOS PEREZ, MANUEL", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 20, "apellidos_y_nombres": "COLAN AVALOS, MIGUEL ANGEL", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 21, "apellidos_y_nombres": "CORDOVA CUETO, MANUEL ARTURO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 22, "apellidos_y_nombres": "COVETTO CEDAÑO, PEDRO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 23, "apellidos_y_nombres": "CUSTODIO BUENO, LUIS ENRIQUE", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 24, "apellidos_y_nombres": "DELGADO RAMIREZ, CARLOS RICARDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 1 } }, "total_general_puntos": 3 },
        { "nro": 25, "apellidos_y_nombres": "DURAND GOMEZ, JOSE ANGEL", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 1, "JN5": 1, "JN6": 1, "TOT": 6 } }, "total_general_puntos": 8 },
        { "nro": 26, "apellidos_y_nombres": "DURAN MUÑOZ, HILMER JAVIER AUGUSTO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 0, "JN4": 0, "JN5": 1, "JN6": 1, "TOT": 4 } }, "total_general_puntos": 6 },
        { "nro": 27, "apellidos_y_nombres": "FLORIAN RODRIGUEZ, JORGE REYNALDO", "asistencias": { "misa_de_retiro": { "AGO": 0.5, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2.5 }, "asambleas": { "AGO": 1, "SET": 0.5, "OCT": 0, "NOV": 0, "TOT": 1.5 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 1, "JN6": 1, "TOT": 4 } }, "total_general_puntos": 8 },
        { "nro": 28, "apellidos_y_nombres": "FLORINDEZ NOIRI, SAMUEL ROLANDO", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 3 }, "asambleas": { "AGO": 1, "SET": 1, "OCT": 0, "NOV": 0, "TOT": 2 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 1, "JN6": 1, "TOT": 4 } }, "total_general_puntos": 9 },
        { "nro": 29, "apellidos_y_nombres": "FLORES BLAS, JOSE ALFREDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 30, "apellidos_y_nombres": "FUENTES SAMAME, GERMAN", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 1, "JN5": 0, "JN6": 0, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 31, "apellidos_y_nombres": "GUZMÁN ROMERO, JORGE EDUARDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 1 } }, "total_general_puntos": 3 },
        { "nro": 32, "apellidos_y_nombres": "HEREDIA ALVAREZ, JAIR JESUS", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 33, "apellidos_y_nombres": "HERERA AYMAR, ANGEL ANTONIO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 34, "apellidos_y_nombres": "HERRERA CHAVEZ, JUAN ANTONIO GUILLERMO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 1 } }, "total_general_puntos": 3 },
        { "nro": 35, "apellidos_y_nombres": "HERRERA CHAVEZ, RAY LEONARDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 3 },
        { "nro": 36, "apellidos_y_nombres": "HURTADO JARA, LUIS ANGEL", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 1, "JN5": 1, "JN6": 1, "TOT": 6 } }, "total_general_puntos": 9 },
        { "nro": 37, "apellidos_y_nombres": "INGA DIAZ, JOSE ANTONIO GUILLERMO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 0, "JN4": 1, "JN5": 0, "JN6": 1, "TOT": 3 } }, "total_general_puntos": 6 },
        { "nro": 38, "apellidos_y_nombres": "INGA ROJAS, JAIME", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 3 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 1, "JN6": 0, "TOT": 3 } }, "total_general_puntos": 7 },
        { "nro": 39, "apellidos_y_nombres": "IZQUIERDO BERNAL, JOSE LUIS", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 0, "JN5": 1, "JN6": 1, "TOT": 5 } }, "total_general_puntos": 7 },
        { "nro": 40, "apellidos_y_nombres": "JARA PORTILLO, CARLOS DANIEL", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 1, "JN5": 0, "JN6": 1, "TOT": 3 } }, "total_general_puntos": 5 },
        { "nro": 41, "apellidos_y_nombres": "LA PUERTA FERNANDEZ, FRANCISCO JOSE", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 0, "JN4": 1, "JN5": 0, "JN6": 0, "TOT": 2 } }, "total_general_puntos": 5 },
        { "nro": 42, "apellidos_y_nombres": "LAZO GOMEZ, JAIME", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 1 } }, "total_general_puntos": 4 },
        { "nro": 43, "apellidos_y_nombres": "LEANO HUAMAN, TOMAS ALFONSO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 1, "JN5": 0, "JN6": 0, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 44, "apellidos_y_nombres": "LIZARRAGA LLERENA, RAFAEL AUGUSTO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 1, "JN6": 1, "TOT": 4 } }, "total_general_puntos": 6 },
        { "nro": 45, "apellidos_y_nombres": "LLERENA ROJAS, SEGUNDO FERNANDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 46, "apellidos_y_nombres": "LUNA LUNA, LUIS MARTIN", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0.5, "NOV": 0, "TOT": 0.5 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 1, "JN6": 1, "TOT": 3 } }, "total_general_puntos": 5.5 },
        { "nro": 47, "apellidos_y_nombres": "MACHICADO VELARDE, JORGE LUIS", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 0, "JN6": 1, "TOT": 2 } }, "total_general_puntos": 4 },
        { "nro": 48, "apellidos_y_nombres": "MACHICADO VELARDE, JOSE LUIS", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 49, "apellidos_y_nombres": "MACHICADO VELARDE, JUAN FRANCISCO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 50, "apellidos_y_nombres": "MALASQUEZ LEYTON, BLADY ALFREDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 1, "JN5": 1, "JN6": 1, "TOT": 6 } }, "total_general_puntos": 8 },
        { "nro": 51, "apellidos_y_nombres": "MENACHO GUERRERO, ALEX ANTONIO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 52, "apellidos_y_nombres": "MENACHO GUERRERO, OMAR WILLIAMS", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 53, "apellidos_y_nombres": "MOLINERO AYALA, JULIO CESAR", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 54, "apellidos_y_nombres": "MOLINERO SILVA, JORGE EDUARDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 1, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 1 }, "jornadas": { "JN1": 1, "JN2": 0, "JN3": 1, "JN4": 0, "JN5": 1, "JN6": 1, "TOT": 4 } }, "total_general_puntos": 7 },
        { "nro": 55, "apellidos_y_nombres": "MONTI BUSTAMANTE, ULDARICO ALFREDO", "asistencias": { "misa_de_retiro": { "AGO": 1, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 3 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 1, "JN2": 1, "JN3": 1, "JN4": 1, "JN5": 0, "JN6": 0, "TOT": 4 } }, "total_general_puntos": 7 },
        { "nro": 56, "apellidos_y_nombres": "MONTES CASTILLO, CARLOS ALBERTO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 },
        { "nro": 57, "apellidos_y_nombres": "NAVARRO MUNDO, CRISTIAN ORLANDO", "asistencias": { "misa_de_retiro": { "AGO": 0, "SET": 0, "OCT": 1, "NOV": 1, "TOT": 2 }, "asambleas": { "AGO": 0, "SET": 0, "OCT": 0, "NOV": 0, "TOT": 0 }, "jornadas": { "JN1": 0, "JN2": 0, "JN3": 0, "JN4": 0, "JN5": 0, "JN6": 0, "TOT": 0 } }, "total_general_puntos": 2 }
    ];

    // Variable global para almacenar los datos cargados
    let attendanceData = [];

    // Función para simular la carga de datos (deberías reemplazar esto por una llamada fetch real)
    function loadAttendanceData(id) {
        // En un entorno de producción, harías: 
        // return fetch(`${id}.json`).then(response => response.json());
        
        // SIMULACIÓN: devolver los datos de la Cuadrilla 12
        if (id === '12') {
            return Promise.resolve(dataCuadrilla12);
        }
        
        // SIMULACIÓN DE DATOS PARA OTRAS CUADRILLAS (ajustar según el ID real)
        if (id === '1' || id === 'gs') {
             // Este es un ejemplo de cómo podría verse un JSON diferente
             return Promise.resolve([
                { "nro": 1, "apellidos_y_nombres": "EJEMPLO SAHUMADORA, ANA MARIA", "asistencias": { "culto": { "OCT": 1, "NOV": 1, "TOT": 2 }, "ensayo": { "ENS1": 1, "ENS2": 0, "TOT": 1 } }, "total_general_puntos": 3 },
                { "nro": 2, "apellidos_y_nombres": "PRUEBA CANTORA, LUZ ELENA", "asistencias": { "culto": { "OCT": 0, "NOV": 1, "TOT": 1 }, "ensayo": { "ENS1": 1, "ENS2": 1, "TOT": 2 } }, "total_general_puntos": 3 }
            ]);
        }

        // Si el ID no es 12, devuelve una promesa vacía por defecto.
        return Promise.resolve([]); 
    }

    // Función principal para renderizar la tabla
    function renderAttendanceTable(data) {
        if (data.length === 0) {
            document.getElementById('tableBody').innerHTML = '<tr><td colspan="100%" style="padding: 20px; color: #7c0000; font-weight: bold;">No hay datos de asistencia disponibles para esta Cuadrilla.</td></tr>';
            return;
        }

        const tableBody = document.getElementById('tableBody');
        const tableHeaderRow = document.getElementById('tableHeaderRow');
        
        tableBody.innerHTML = '';
        tableHeaderRow.innerHTML = '';

        // 1. GENERAR CABECERAS
        tableHeaderRow.innerHTML += '<th>Nro</th><th>Apellidos y Nombres</th>';
        
        // Obtener la estructura de actividades (asistencias) del primer hermano
        const sampleMember = data[0];
        const activityGroups = sampleMember.asistencias; // misa_de_retiro, asambleas, jornadas

        let colspanIndex = {}; // Guardar cuántas subcolumnas tiene cada grupo
        
        for (const groupName in activityGroups) {
            const activities = activityGroups[groupName]; // {AGO: 0, SET: 0, ...}
            const activityKeys = Object.keys(activities).filter(key => key !== 'TOT'); // Excluir la columna TOTAL de la sub-cabecera
            
            colspanIndex[groupName] = activityKeys.length + 1; // +1 para la columna TOT
            
            // Sub-cabecera (combinada, ejemplo: MISAS DE RETIRO)
            const combinedHeader = document.createElement('th');
            combinedHeader.colSpan = colspanIndex[groupName];
            combinedHeader.textContent = groupName.replace(/_/g, ' ').toUpperCase(); // Título legible
            tableHeaderRow.appendChild(combinedHeader);
        }
        
        tableHeaderRow.innerHTML += '<th>Total Puntos</th>';

        // Insertar una segunda fila de cabecera para los meses/jornadas
        const subHeaderRow = document.createElement('tr');
        subHeaderRow.innerHTML += '<th></th><th></th>'; // Espacios para Nro y Nombre

        for (const groupName in activityGroups) {
            const activities = activityGroups[groupName];
            const activityKeys = Object.keys(activities);
            
            activityKeys.forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                // Aplicar estilo de color diferente para el total (TOT)
                if (key === 'TOT') {
                    th.style.backgroundColor = '#5d0000';
                }
                subHeaderRow.appendChild(th);
            });
        }
        document.querySelector('#attendanceTable thead').appendChild(subHeaderRow);


        // 2. GENERAR CUERPO DE LA TABLA (DATOS)
        data.forEach(hermano => {
            const row = document.createElement('tr');
            
            // Columna 1: Nro
            row.innerHTML += `<td>${hermano.nro}</td>`;
            
            // Columna 2: Nombre (usada para búsqueda)
            row.innerHTML += `<td class="hermano-name">${hermano.apellidos_y_nombres}</td>`;
            
            // Columnas de Asistencia
            for (const groupName in hermano.asistencias) {
                const activities = hermano.asistencias[groupName];
                for (const key in activities) {
                    const value = activities[key];
                    let cellClass = '';
                    let displayValue = value;

                    if (key !== 'TOT') {
                        cellClass = (value >= 1) ? 'asistencia-si' : ((value > 0) ? 'asistencia-si' : 'asistencia-no');
                        displayValue = (value >= 1) ? '✓' : (value > 0 ? '½' : 'X');
                    }
                    
                    const td = document.createElement('td');
                    td.className = cellClass;
                    td.textContent = displayValue;
                    
                    // Resaltar totales
                    if (key === 'TOT') {
                        td.style.fontWeight = 'bold';
                        td.style.backgroundColor = '#fce4ec'; /* Un color de fondo suave */
                    }

                    row.appendChild(td);
                }
            }
            
            // Columna Final: Total General de Puntos
            row.innerHTML += `<td><strong>${hermano.total_general_puntos}</strong></td>`;
            
            tableBody.appendChild(row);
        });
    }
    
    // Función de Búsqueda
    function filterTable() {
        const input = document.getElementById('searchInput');
        const filter = input.value.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, ""); // Normalizar tildes/ñ
        const table = document.getElementById('attendanceTable');
        const tr = table.getElementsByTagName('tr');
        let found = false;
        let visibleCount = 0;

        for (let i = 2; i < tr.length; i++) { // Empezar en la fila 2 para saltar las dos filas de encabezado
            const td = tr[i].getElementsByTagName('td')[1]; // Columna 1 es el nombre del Hermano
            if (td) {
                const textValue = td.textContent || td.innerText;
                const normalizedText = textValue.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                
                if (normalizedText.indexOf(filter) > -1) {
                    tr[i].style.display = "";
                    visibleCount++;
                } else {
                    tr[i].style.display = "none";
                }
            }
        }

        // Mostrar u ocultar el mensaje de "No Results"
        document.getElementById('noResults').style.display = (visibleCount === 0) ? 'block' : 'none';
    }


    // *************************
    // LÓGICA DE INICIALIZACIÓN
    // *************************
    
    document.addEventListener('DOMContentLoaded', () => {
        const cuadrillaId = getQueryParam('id') || '12'; // Por defecto es 12 si no hay parámetro.

        // 1. Configurar Título y Logo
        const title = getCuadrillaTitle(cuadrillaId);
        const logoName = getLogoFileName(cuadrillaId);
        
        document.getElementById('cuadrillaTitle').textContent = `ASISTENCIAS - ${title.toUpperCase()}`;
        document.getElementById('cuadrillaLogo').src = `./assets/logos/${logoName}`; // Asume que tienes una carpeta 'assets/logos'
        document.getElementById('infoId').textContent = `ID de Cuadrilla: ${cuadrillaId}`;

        // 2. Cargar y Renderizar Datos
        loadAttendanceData(cuadrillaId)
            .then(data => {
                attendanceData = data;
                renderAttendanceTable(attendanceData);
            })
            .catch(error => {
                console.error("Error al cargar los datos de la cuadrilla:", error);
                document.getElementById('tableBody').innerHTML = '<tr><td colspan="100%" style="color: red; font-weight: bold;">Error al cargar los datos. Verifique el ID.</td></tr>';
            });
            
        // 3. Habilitar la búsqueda al escribir (opcional: mejor UX)
        document.getElementById('searchInput').addEventListener('keyup', filterTable);
    });

</script>

</body>
</html>
